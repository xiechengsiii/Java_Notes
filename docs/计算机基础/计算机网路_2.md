## 应用层

![image-20200704082750090](E:\Typora\imgs\image-20200704082750090.png)

每一个应用层协议，对应着计算机的一个服务。比如web服务，用的http协议，其实就是使用tcp的80端口来标识的一个web服务， 可以认为  http = tcp + 80（也可以使其他端口）;

**网络应用模型**

- 客户/服务模型(C/S)

  ![image-20200805170433221](E:\Typora\imgs\image-20200805170433221.png)

- P2P模型（peer - to - peer）

  ![image-20200805170710933](E:\Typora\imgs\image-20200805170710933.png)

#### DNS

##### 作用

​	将域名解析成IP地址

- 域名 

  根  **.**

  顶级域名 com  edu  net  cn  org gov

  二级域名 91xueit

  三级域名  xxxx

  一般买域名，就是买2级域名，保证二级域名全球唯一

  ![image-20200805194851233](E:\Typora\imgs\image-20200805194851233.png)

- 域名解析的过程

  是一种分布式的查询过程  
  
  ![image-20200805195634795](E:\Typora\imgs\image-20200805195634795.png)
  
  递归查询 靠别人， 迭代查询靠自己（"自己"指的就是本地域名服务器）
  
  采用高速缓存可以加速查询过程：实际上查询的时候主机先查自己的缓存有没有对应的地址，再查本地域名 服务器的缓存；

#### DHCP

  动态分配IP的协议 ， 可以跨网段分配地址

DHCP服务器的IP地址必须是静态地址，不能是动态/自动获得的。

释放租约  ipconfig  /release 

- 如何跨网段分配地址呢？

  需要给多少网段分配地址，就需要在DHCP服务器上创建多少个作用域，不同的作用域对应不同的网关

  每次请求地址的时候，发送一个广播，但是路由器是隔绝广播（**广播不能跨网段**）的，广播只能在本网段上传；所以需要在路由器接口上配一个命令：``IP helper addresss``,地址写上DHCP服务器地址。那么路由器收到一个广播请求的时候，路由器会把这个广播请求变成定向请求找对应的DHCP服务器，同时源IP 为路由器这个接口的地址（也就是是网关）。然后DHCP会选择一个IP分配给这个网段的计算机。

  其实对于主机A ： 是已知本机的MAC地址，然后请求获得IP地址，是逆向ARP的过程。

  ARP 是 IP ---> MAC  也是用的广播

#### FTP

​	服务器进程 有两种：

- 一个主进程 监听客户端发送来的请求

- n个从属进程，处理n个客户端的请求

![image-20200805211220829](E:\Typora\imgs\image-20200805211220829.png)

控制进程和数据传送进程都属于从属进程

只要会话保持，那么控制连接就会始终保持，不会断开；

##### FTP连接方式

- 控制连接

  标准端口为21， 用于发送FTP命令信息，比如我是删除，上传，还是下载一个文件（什么样的文件操作）

- 数据连接

  标准端口为20，用于上传、下载数据
  
  传送一个文件创建一个会话，而不是N个文件同一个会话；
  
  

##### 连接类型

- 主动模式   服务端从20端口主动向客户端发起连接

- 被动模式  服务端在指定范围内的某个端口被动等待客户端发起连接

  所以，FTP服务端如果有防火墙，需要在防火墙打开20,21端口，使用主动模式进行数据连接

  **可以通过端口号来区分是主动还是被动模式**

  <img src="E:\Typora\imgs\image-20200704155159625.png" alt="image-20200704155159625" style="zoom:67%;" />

##### FTP传输模式

- 文本模式    ACSII模式   以文本序列传数据
- 二进制模式  Binary模式  以二进制序列传数据

  

##### TELNET 远程终端协议

​	TCP 的23端口

##### RDP    

远程桌面协议  Remote Desktop Protocol   windows系统运行命令``mstsc``

##### Http  超文本传输协议

![image-20200806101559935](E:\Typora\imgs\image-20200806101559935.png)

---

![image-20200806101841665](E:\Typora\imgs\image-20200806101841665.png)

**Http协议的特点**

![image-20200806102149670](E:\Typora\imgs\image-20200806102149670.png)

---

![image-20200806103942947](E:\Typora\imgs\image-20200806103942947.png)

持久连接不需要每次请求都建立连接，从发送请求到收到数据所需要的时间只是略大于一个RTT

---

 **HTTP报文结构**

![image-20200806104726026](E:\Typora\imgs\image-20200806104726026.png)

![image-20200806105214608](E:\Typora\imgs\image-20200806105214608.png)

#####  电子邮件（SMTP, POP3, IMAP）

​	SMTP 发邮件， POP3, IMAP收邮件

###### SMTP

![image-20200806094721367](E:\Typora\imgs\image-20200806094721367.png)

这里的用户代理指的就是邮件客户端

![image-20200806094801291](E:\Typora\imgs\image-20200806094801291.png)

SMTP是建立在TCP连接之上的， C/S模式， 使用的熟知端口号为25

![image-20200806095450466](E:\Typora\imgs\image-20200806095450466.png)

- SMTP通信的三个阶段

  ![image-20200806100014397](E:\Typora\imgs\image-20200806100014397.png)

A：SMTP客户端    B：SMTP服务端

SMTP的局限性：![image-20200806100313031](E:\Typora\imgs\image-20200806100313031.png)

###### POP3  邮局协议

建立在TCP连接至上，熟知端口号为110，C/S模式

![image-20200806100527671](E:\Typora\imgs\image-20200806100527671.png)

###### IMAP  忘记报文存取协议

![image-20200806100632532](E:\Typora\imgs\image-20200806100632532.png)

###### 基于万维网的电子邮件

 ![image-20200806100745657](E:\Typora\imgs\image-20200806100745657.png)

不需要一个专门的客户端软件，直接通过浏览器既可以收发邮件 



## 网络安全

网络攻击分为主动攻击和被动攻击

<img src="E:\Typora\imgs\image-20200710201918287.png" alt="image-20200710201918287" style="zoom: 80%;" />

##### 加密技术

- 对称加密

  比如有这样一种场景 A 发送文件给B，需要对文件中的内容加密，加密策略是：所有字母的ASCII码都往后移一位，比如a -->b, b -->c，这样传送文件后B再按照对应的规则进行解密。但是传递文件之间，首先A---B之间得协商好密钥，比如A把共享密钥传输给B，但是在**这个过程中密钥可能被截获**。

  - 优点    效率高
  - 缺点    密钥不适合在网上传输，不安全；密钥维护麻烦：比如100个员工，都要传输加密文件，那么俩俩员工之间都必须有自己单独的密钥，而不是100个员工共享1个相同密钥；

- 非对称加密

  加密密钥和解密秘钥是不同的。密钥必须成对使用，公钥加密 + 私钥解密。比如A --->B 发送加密文件，A要用B的公钥然后给文件加密，然后B用自己的私钥可以解密。

  - 优点   方便维护一点。比如100个员工之间发送加密文件，只需要每个员工自己有一对密钥即可，私钥自己保存，公钥发给他人。
  - 缺点   效率低 

  如何避免效率低的缺点呢？可以对称加密和非对称加密结合使用：比如A---->B，A用对称加密的密钥加密一个很大的文件1GB,这个效率很高，然后再用B的非对称加密的公钥加密这个共享密钥，然后将文件+ 密钥同时传递给B。 B的解密过程：B先用自己的私钥可以解密得到共享密钥，再用共享密钥解密对称加密的大文件。由于共享密钥比较短，即使用非对称加密耗时也很低。这样既安全，效率也高。

  ​	非对称加密还用于生成**数字签名**。数字签名可以保证内容不被更改，加密是保证内容不被看到。
  
  ​	数字签名用自己的私钥加密，然后和和公钥一起发送出去；接收端用公钥解密，如果能解密，则说明是A；
  
  不过这个数字签名都是受信任的CA颁发的，公钥私钥也是CA给你的；
  
  ​	数字签名可以用来证明身份，且可以用来验证文件是否被修改过（文件摘要）;



##### Internet上使用的安全协议

###### 		SSL

​		位于应用层和传输层之间。<img src="E:\Typora\imgs\image-20200713230558786.png" alt="image-20200713230558786" style="zoom:67%;" />

注意    http ：使用的TCP的80端口 ， https使用过的TCP的443端口

​	SSL提供了三个功能：<img src="E:\Typora\imgs\image-20200713233151929.png" alt="image-20200713233151929" style="zoom:80%;" />

###### 	网络层的安全--IPsec

​	网络层安全；

​	这是属于底层的加密，对于用户是透明的。不像SSL，还需要申请证书之类的。

<img src="E:\Typora\imgs\image-20200714223804818.png" alt="image-20200714223804818" style="zoom:80%;" />

- IPsec中主要的两个协议

  ![image-20200714223910166](E:\Typora\imgs\image-20200714223910166.png)

  - AH协议  相当于对数据包只进行了签名

    <img src="E:\Typora\imgs\image-20200714224143062.png" alt="image-20200714224143062" style="zoom:80%;" />

    数据仍然能看见（未加密），抓包后，可以知道，在网络层和应用层协议之间多了一层数据：

    ![image-20200714233133853](E:\Typora\imgs\image-20200714233133853.png)

  - ESP协议  相当于对数据包进行了加密 + 签名

    ##### <img src="E:\Typora\imgs\image-20200714224323051.png" alt="image-20200714224323051" style="zoom:80%;" />

    用了ESP协议之后，你抓包工具，不仅看不到里面的数据，连传输层用的协议都无法知道（不显示）:

    ![image-20200714232656141](E:\Typora\imgs\image-20200714232656141.png)

###### 数据链路层的安全

​	大多数上指数据链路上的安全，和网络层的安全不同：

- 网络层安全是点到点的， A ---->B,  A加密， 然后B解密， 中间的节点根本不知道数据是否加密，只负责转发；也就是A的数据出了A的网卡加密了， 到了B的网卡再解密；

- 而数据链路的安全，A发送数据的时候数据并没有加密，B收到的数据也不需要解密，数据的加密和解密是中间设备之间进行的

  可以由PPP协议实现身份认证功能

###### 防火墙

<img src="E:\Typora\imgs\image-20200715071417943.png" alt="image-20200715071417943" style="zoom:80%;" />

<img src="E:\Typora\imgs\image-20200715071455347.png" alt="image-20200715071455347" style="zoom:80%;" />





## 无线网络

<img src="E:\Typora\imgs\image-20200715090129908.png" alt="image-20200715090129908" style="zoom:80%;" />

<img src="E:\Typora\imgs\image-20200715091229971.png" alt="image-20200715091229971" style="zoom:80%;" />

这个ssid : 就是无线网络的名称，比如zju-wlan；

你的电脑可以搜到多个无线AP；

一个基本服务集可以是孤立的，也可以通过接入点AP连接到一个主干分配系统``DS(Distribution System)``,然后再接入到另一个基本服务集，构成扩展的服务集ESS(Extended Service Set)

**移动自组网络**<img src="E:\Typora\imgs\image-20200715092951477.png" alt="image-20200715092951477" style="zoom:80%;" />

