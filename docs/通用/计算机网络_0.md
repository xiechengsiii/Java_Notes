##### 因特网的组成

<img src="E:\Typora\imgs\image-20200623103541077.png" alt="image-20200623103541077" style="zoom:67%;" />

边缘部分一般就指计算机，服务器；核心部分一般指那些网络互连设备

<img src="E:\Typora\imgs\image-20200623103710481.png" alt="image-20200623103710481" style="zoom: 67%;" />

##### 计算机网络的性能

- **速率**  连接在网络上的主机在数字信道传输数据位数（bit）的速率

  b/s, Mb/s , kb/s, Gb/s

  A →----------------------------------→B   一个信道

  ![image-20200715193905550](E:\Typora\imgs\image-20200715193905550.png)

  注意速率是小写， 存储容量是大写，并且换算不同

- **带宽**  计算机网络中，带宽表示接口所能传输数据的能力，  单位为b/s  kb/s  Mb/s Gb/s；通常指单位时间内从网络中的一点到另一点所能通过的最高速率。也就是网络设备的所支持的最高速度。

- **吞吐量** 单位时间通过网络的数据量（所有信道流量加在一块）

- **时延**   

  指数据从网络一端传送到另一端所需的时间
  
  ![image-20200715200852344](E:\Typora\imgs\image-20200715200852344.png)
  
  
  
- **时延带宽积**![image-20200715201118189](E:\Typora\imgs\image-20200715201118189.png)

- **往返时间（RTT）** 从发送方发送数据到发送方收到接受确认的时间   ping - www.baidu.com  可以看

  ![image-20200715201331061](E:\Typora\imgs\image-20200715201331061.png)

  

- **利用率**

<img src="E:\Typora\imgs\image-20200623104624623.png" alt="image-20200623104624623" style="zoom: 50%;" />  

  

##### 计算机网络的体系结构

​	OSI参考模型

- 应用层

  能够产生网络流量并能够与用户交互的应用程序

- 表示层

  传输数据的加密，压缩之类的， 用于开发人员

- 会话层

  服务端与客户端建立的会话      cmd命令： netstat -n       netstat -nb  可以用来查木马:开机的时候没开任何应用程序直接运行这个命令，看看有哪些会话:

  <img src="E:\Typora\imgs\image-20200623161820463.png" alt="image-20200623161820463" style="zoom: 80%;" />

- 传输层

  可靠传输（建立会话），  不可靠传输（一般只需要传一个数据包就可以用不可靠的传输；以及广播通信也是不可靠）； 流量控制

- 网络层

  IP地址编址   选择最佳路径

- 数据链路层

  数据如何封装， 添加物理地址 --MAC

- 物理层

  电压，接口标准

**之所以要这样分层，是为了解耦，当一层发生变化的时候，对其它层是透明的，没有影响的。**

分层开发

网络排错     **从底层（物理层）到高层（应用层）**

**几个概念**

<img src="E:\Typora\imgs\image-20200623165732561.png" alt="image-20200623165732561" style="zoom:80%;" />

![image-20200623170349362](E:\Typora\imgs\image-20200623170349362.png)

![image-20200715210100325](E:\Typora\imgs\image-20200715210100325.png)

##### 各层

###### 应用层

​	所有能和用户交互产生流量的程序

###### 表示层<img src="E:\Typora\imgs\image-20200715212947607.png" alt="image-20200715212947607" style="zoom:80%;" />

###### 会话层<img src="E:\Typora\imgs\image-20200715213319269.png" alt="image-20200715213319269" style="zoom:80%;" />

###### 传输层

​	负责主机中两个进程的通信，即端到端的通信。传输单位是报文段或用户数据段。

<img src="E:\Typora\imgs\image-20200715213908005.png" alt="image-20200715213908005" style="zoom:80%;" />

###### 网络层

![image-20200715214316023](E:\Typora\imgs\image-20200715214316023.png)

###### 数据链路层

![image-20200715214619654](E:\Typora\imgs\image-20200715214619654.png)

###### 物理层

主要任务是在物理媒体上实现比特流的透明传输。传输单位是bit。

<img src="E:\Typora\imgs\image-20200715215013370.png" alt="image-20200715215013370" style="zoom:80%;" />

## 物理层

#### 物理层的基本概念

![image-20200624094438593](E:\Typora\imgs\image-20200624094438593.png)

#### 有关信道的一些基本概念

信道表示向一个方向传输信息的媒体。平时说的通信线路往往包含一条发送信息的信道和一条接受信息的信道。

- 单向通信（单工通信）

  ​	只能有一个方向的通信而没有反方向的通信（电视天，广播电台）

- 双向交替通信（半双工通信）

  ​	通信的双方都可以发信息，但是双方不能同时发送

- 双通同时通信（全双工通信）

  ​	通信双发可以同时接受和发送信息-

- 信道复用技术

  比如一个20GB带宽的光纤，只用来传输A--B  4Kb带宽的信息就太浪费了，所以许多发送--接收端可以共用这一个信道

  - 频分复用

    ![image-20200624105829670](E:\Typora\imgs\image-20200624105829670.png)

  - 时分复用

    ![image-20200624105725126](E:\Typora\imgs\image-20200624105725126.png)

    ​	想想：如果A， B数据是空的，但是也得留位置给A, B，这样就造成了资源的浪费

  - 码分复用
  
  - 波分复用



## 数据链路层

##### 数据链路的信道类型

![image-20200624134336322](E:\Typora\imgs\image-20200624134336322.png)

##### 链路与数据链路

![image-20200624134418092](E:\Typora\imgs\image-20200624134418092.png)

数据链路层的功能概述![image-20200718155033785](E:\Typora\imgs\image-20200718155033785.png) 

​	如果通信质量好，比如有线传输链路，链路层向网络层提供的是无确认无连接服务；

​	对于通信质量差的无线传输链路，链路层提供的有确认无连接服务和有确认面向连接服务。

##### 数据链路层的基本问题

###### 封装成帧  

​	就是必须确定一个帧是从哪开始的，从哪结束的。

- 在一段数据的前后分别添加首部和尾部，就构成了一个帧。确定帧的界限。

- 首部和尾部的一个重要作用就是进行帧定界

  ![image-20200624135002540](E:\Typora\imgs\image-20200624135002540.png)

###### 透明传输

​	指不管传输的数据是什么样的比特组合，都应当能在链路上传送。链路层是看不见有什么妨碍数据传输的东西。当所传数据的比特组合恰好与某一个控制信息完全一样时，就必须采取适当的措施，使接受方不会对信息误判。

- 若传输的数据不是仅有ASCII码中“可打印字符（共95个）”组成时（**即出现了标识数据帧头尾字符的字符时**），会出问题 ：

  ![image-20200624135525022](E:\Typora\imgs\image-20200624135525022.png)

  解决方法：加转义字符或者填充0 ： 字节填充或者零填充 

  字节填充法：
  
  ![image-20200624135620669](E:\Typora\imgs\image-20200624135620669.png)
  
  SOH :start of head   EOT:end of tranmission    ESC:转义字符
  
  对于接受方，把头尾和转义字符去掉之后，剩下俩的便是原始数据
  
  零填充：![image-20200718162557079](E:\Typora\imgs\image-20200718162557079.png)
  
  
  
  帧头帧尾是由``0 1 1 1 1 1 1 0 ``(连续6个1)构成的

###### 差错控制

<img src="E:\Typora\imgs\image-20200718162959880.png" alt="image-20200718162959880" style="zoom:50%;" />

链路层主要针对的位错，帧错主要由传输层解决

![image-20200624135730873](E:\Typora\imgs\image-20200624135730873.png)

- 循环冗余检测 CRC   （属于检测编码，还有一种是奇偶校验）

![image-20200624135931726](E:\Typora\imgs\image-20200624135931726.png)

循环冗余检测过程

<img src="E:\Typora\imgs\image-20200624140524551.png" alt="image-20200624140524551" style="zoom:80%;" />

​	即 要传的数从101001000 变为 101001001， 接受方再对传过来的数进行一次除法，如果余数==0，则没问题，不等于0说明传输过程有错，直接丢掉这个帧。

​	比如 A ----R1 --- R2 --- R3----- > B发送数据，中间经过R1 --R2出现错误了 ， 则R2 是直接丢掉这个帧的，不会要求R1重传，R1发送完之后也只直接丢掉；但是接收端会通知发送端A重新传送，这是A --B两个端实现的可靠（两端的应用程序要求重传？）。

​	至于除数，后面的位数是多少位，由数据链路层的协议决定，用户不用关心。

![image-20200721190033420](E:\Typora\imgs\image-20200721190033420.png)

![image-20200721190149044](E:\Typora\imgs\image-20200721190149044.png)



数据链路层仅仅使用循环冗余CRC差错检测技术，只能做到对帧的无差错接受，即“**凡是接收端数据链路层接受的帧，我们都能以<font color = red>非常接近1</font>的概率认为这些帧在传输过程中没有产生差错**”。接受端丢弃的帧虽然曾收到了 ， 但是最终因为有差错被丢弃。

 	“可靠传输“ ：数据链路层发送端发送什么，接收端就收到什么

​	链路层使用CRC校验，能够实现无比特差错的传输，但是还不是可靠传输

- 纠错编码---海明码

###### 流量控制

​	较高的发送速度和较低的接受能力的不匹配，会造成传输差错；

​	<font color = red>数据链路层的流量将控制是点对点的（相邻节点的），而传输层的流量控制是端到端的（两个主机之间）；还有一个区别是：链路层的流量控制：接受方收不到就不回复确认，而传输层接收端会给发送端一个窗口公告。</font>

![image-20200721194834994](E:\Typora\imgs\image-20200721194834994.png)



- 停止-等待协议  发送窗口大小=1， 接收窗口大小= 1；

- 后退N帧协议（GBN） 发送窗口大小 > 1, 接受窗口大小 = 1

- 选择重传协议（SR）  发送窗口大小 > 1, 接受窗口大小 >1

  **注意链路层的窗口大小在发送过程中时固定大小的；不像传输层是可变的**

  ![image-20200721195252370](E:\Typora\imgs\image-20200721195252370.png)



- **停止等待协议**

  为了解决流量控制和可靠传输的问题

  ![image-20200721195848907](E:\Typora\imgs\image-20200721195848907.png)

![image-20200721200528906](E:\Typora\imgs\image-20200721200528906.png)

​	RTT:数据帧的往返时延

![image-20200721200719853](E:\Typora\imgs\image-20200721200719853.png)

![image-20200721200846930](E:\Typora\imgs\image-20200721200846930.png)

![image-20200721201340528](E:\Typora\imgs\image-20200721201340528.png)

- **GBN 后退N帧协议**

  可以累积确认，但是缺点是某一帧出现问题的时候，会批量重传导致传送效率下降

  ![image-20200721223451049](E:\Typora\imgs\image-20200721223451049.png)

  这里的上层就是指网络层

  ![image-20200721223715084](E:\Typora\imgs\image-20200721223715084.png)

![image-20200721230720122](E:\Typora\imgs\image-20200721230720122.png)

![image-20200721230935010](E:\Typora\imgs\image-20200721230935010.png)

帧序号是循环使用的

GBN性能分析

​		优点   因为连续发送数据帧而提高了信道利用率

​		缺点    在 重传的时候必须把原来已经正确传送的数据帧重传，降低了传送效率

- **SR  选择重传协议**

![image-20200721232522086](E:\Typora\imgs\image-20200721232522086.png)

​		0，1,2,3是已发送并且收到确认；4已发送但是没有收到确认（同时copy的一份数据帧），5,67还未发送	

![image-20200721232923271](E:\Typora\imgs\image-20200721232923271.png)

![image-20200721233248815](E:\Typora\imgs\image-20200721233248815.png)

![image-20200721234111843](E:\Typora\imgs\image-20200721234111843.png)

SR协议重点

- 对数据帧逐一确认，收一个确认一个

- 只需要重传出错的帧

- 接受方有缓存

- Wtmax = Wrmax = 2^(n - 1)

  ![image-20200721234704739](E:\Typora\imgs\image-20200721234704739.png)



##### 两种链路

​	![image-20200722192323820](E:\Typora\imgs\image-20200722192323820.png)

介质访问控制  MAC   multiple access control  针对于广播式链路

各个节点访问共享信道的时候，会产生冲突，所以有了MAC

![image-20200722211805239](E:\Typora\imgs\image-20200722211805239.png)

![image-20200722192355126](E:\Typora\imgs\image-20200722192355126.png)  

![image-20200722193127475](E:\Typora\imgs\image-20200722193127475.png)



###### ALOHA协议

###### 轮询协议

![image-20200722212045662](E:\Typora\imgs\image-20200722212045662.png)



​	轮询是要发送数据的数据帧的，所以有轮询开销；等待延迟指前面的主机空闲不需要发送数据，但是后面的主句要发送数据，需要等主节点轮训完前面的主机后才能等发送，有延迟；单点故障即主节点挂了。

###### 令牌传递协议

​	![image-20200722212707161](E:\Typora\imgs\image-20200722212707161.png)

###### CSMA/CA协议

​	![image-20200723200821341](E:\Typora\imgs\image-20200723200821341.png)

![image-20200723200934026](E:\Typora\imgs\image-20200723200934026.png)



###### CSMA/CD协议

![image-20200723212237669](E:\Typora\imgs\image-20200723212237669.png)

![image-20200723213056705](E:\Typora\imgs\image-20200723213056705.png)

对于A，检测到发生碰撞的可能时间为（0, 2τ）， 最多为2τ。

![image-20200723213741856](E:\Typora\imgs\image-20200723213741856.png)

![image-20200723214123455](E:\Typora\imgs\image-20200723214123455.png)

​	 

##### 点对点信道---PPP协议

​	![image-20200723221602986](E:\Typora\imgs\image-20200723221602986.png)

​	使用的最多的数据链路层协议-- 点对点协议   , 只支持**全双工链路**

<img src="E:\Typora\imgs\image-20200624184437261.png" alt="image-20200624184437261" style="zoom:80%;" />

######  PPP协议帧格式

​	![image-20200625104109776](E:\Typora\imgs\image-20200625104109776.png)

![image-20200723222838125](E:\Typora\imgs\image-20200723222838125.png)

​	注意到PPP协议没有地址的相关信息，因为它是点对点的协议，没有第三者，不需要地址信息 

​	传播的数据都是整数个字节，PPP协议是面向字节的协议

##### HDLC协议

![image-20200723223810115](E:\Typora\imgs\image-20200723223810115.png)

![image-20200723223832378](E:\Typora\imgs\image-20200723223832378.png)



##### 数据链路层--以太网特点	

 	以太网提供无连接，不可靠的服务

- 无连接     发送方和接受方无”握手“过程

- 不可靠    不对发送方的数据帧编号，接受方不回确认，差错直接丢弃，差错纠正由高层负责

  <font color = red>以太网只实现无差错接收，不实现可靠传输（你发来的所有帧我都要接收，可靠传输是由传输层实现的）</font>

  

​	以太网使用CSMA/CD协议（有线网络）  载波监听多路访问协议   常用于广播式链路

​	而CSMA/CA协议适用于无线局域网

​	核心思想是发送帧之前先监听信道

![image-20200625205448690](E:\Typora\imgs\image-20200625205448690.png)

​	广播信道的数据链路层  用的**带冲突检测的多点接入技术**

- 冲突检测和避让机制

###### ![image-20200625110421449](E:\Typora\imgs\image-20200625110421449.png)

- 二进制指数类型退避算法

  ![image-20200625110951939](E:\Typora\imgs\image-20200625110951939.png)

###### 以太网数据帧格式<img src="E:\Typora\imgs\image-20200625213805056.png" alt="image-20200625213805056" style="zoom:80%;" />

![image-20200625214201364](E:\Typora\imgs\image-20200625214201364.png)

​	1500 是数据链路层的最大传输单元 MTU   64是帧的最小长度

#####  扩展以太网

在物理层上扩展![image-20200723224335422](E:\Typora\imgs\image-20200723224335422.png)

​	冲突域：在这个集线器连接的多台主机中，同一时刻只能有一台主机发送信息

链路层扩展以太网

- 网桥  网桥接口连集线器 （用的很少了，降低冲突域的范围，“智商”比集线器高）

  ![image-20200723225603570](E:\Typora\imgs\image-20200723225603570.png)

- 交换机   是一种多接口网桥，直接连计算机， 安全，效率高，可以收发端可以全双工通信。

  ![image-20200723230512652](E:\Typora\imgs\image-20200723230512652.png)
  
  ![image-20200723230632402](E:\Typora\imgs\image-20200723230632402.png)
  
  交换机的接口有存储和转发的功能， 传送信息的时候按先后顺序可以进行排队
  
  ![image-20200723230804480](E:\Typora\imgs\image-20200723230804480.png)
  
  对于链路层的设备（交换机 && 网桥），每一个端口，每一个端口就是一个冲突域 
  
  ![image-20200723230940707](E:\Typora\imgs\image-20200723230940707.png)
  
  只要没有路由器，那就只有一个广播域；

![image-20200723231216454](E:\Typora\imgs\image-20200723231216454.png)

###### LAN 和 VLAN

- LAN 局域网    使用的是**广播信道**

  ![image-20200723201421162](E:\Typora\imgs\image-20200723201421162.png)

  传播介质

  - 有线局域网    常用介质：双绞线， 光纤，同轴电缆等
  - 无线局域网    介质 ： 电磁波（空气）

  ![image-20200723202613001](E:\Typora\imgs\image-20200723202613001.png)

  ![image-20200723203044558](E:\Typora\imgs\image-20200723203044558.png)

  LLC为网络层提供服务， MAC子层和物理层相关

- 无线局域网

  ![image-20200723211558297](E:\Typora\imgs\image-20200723211558297.png)

![image-20200723211611663](E:\Typora\imgs\image-20200723211611663.png)

- VLAN 虚拟局域网      其实就是“逻辑上的局域网” 

  <img src="E:\Typora\imgs\image-20200625223640731.png" alt="image-20200625223640731" style="zoom:67%;" />

  不同VLAN之间想要通信需要通过路由器或者三层交换机实现

  

  ![image-20200625223457526](E:\Typora\imgs\image-20200625223457526.png)

  其中**干道链路**用的**统计时分复用**技术  ,可以数据帧格式中插入一个VLAN标记（比如ID）

  ###### VLAN数据帧格式

  ![image-20200625224103027](E:\Typora\imgs\image-20200625224103027.png)

  

















































